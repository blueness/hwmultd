=head1 NAME

B<hwmultd> - multicast hardware information, or respond to mutlicasted
hardware information

=head1 SYNOPSIS

B<hwmultd> [-h] [-v] [-c F<config> ]

=head1 DESCRIPTION

B<hwmultd> operates in one of two modes (or both).  As a server,
B<hwmultd> monitors hardware information and multicasts it so that
other computers in the same multicast group can act accordingly.  As a
client, B<hwmultd> listens to multicasted hardware information and acts
accordingly.  For example, one box (the server) can multicast entropy
while others listening (the clients) can add it to their own entropy
pools.

=head1 OPTIONS

=over

=item B<no option>

This is the normal mode of operation.  B<hmultd> reads its
configuration file, drops root privileges, opens its log and
pid file and forks into the background as a daemon.

=item B<-c config>

Use an alternate configuration file instead of the default
F</etc/hwmultd/hwmultd.conf>.

=item B<-h>

Do not fork into the background.  Print out information about
command line options and exit.

=item B<-v>

Do not fork into the background.  Print out version information
and exit.

=back

=head1 SIGNALS

B<hwmultd> responds to three signals F<SIGTERM>, F<SIGHUP> and
F<SIGUSR1>.  All others blockable signals are masked.

=over

=item F<SIGTERM>

Exit cleanly.  Close all sockets, file descriptors and
unlink the pid file.

=item F<SIGHUP>

Reread the configuration file(s) and, depending on what mode
B<hwmultd> is running in, restart the multicast client, server
or both.

=item F<SIGUSR1>

Reset the plugin hardware.  Depending on how the plugin works
with its hardware, this signal will instruct it to close and
reopen the hardware device.  This is useful in case the hardware
has gotten into a bad state.

=back

=head1 FILES

=over

=item F</etc/hwmultd/hmultd.conf>

The daemon's main configuration file.  Each line is interpreted as
case sensitive, white space delimited, B<key> B<value> pairs.  Malformed
lines are ignored.  Anything after an octothorpe '#' is also ignored.
A missing B<key> B<value>'s is interpreted as "use the default value".

=item F</etc/hwmultd/plugin_mode.conf>

Per plugin configuration file(s).  Its format is the same as that of
the main configuration file.  The filename I<plugin_mode.conf>
must correspond to the filename I<plugin_molde.so> of the plugin that
consumes it.

=item F</usr/lib/hwmultd/>

The directory where B<hwmultd> searches for its plugins.  Plugin
names have the form I<plugin_mode.so> where I<plugin> is the name,
and I<mode> is either I<hw> for server mode (ie. read hardware and
multicast), or I<cl> for client mode (ie. read multicated information
and act accordingly).

The number of plugins is growing.  Current plugins are

=over

=item B<entropy_hw.so>

This server plugin reads some entropy device, by default
F</dev/urandom>, and multicasts some random data.  It is
configured by B<entropy_hw.conf> which takes two options,
I<Device> which specifies the device, and I<Bytes> which
specifies the number of bytes to read per cycle --- see
the B<Timing> option in B<MAIN CONFIGURATION FILE OPTIONS>
below.

=item B<entropy_cl.so>

This client plugin accepts multicasted random data, as
provided by B<entropy_hw.so>, and adds it to the local
entropy pool using B<ioctl>() on the device specified by
the B<Device> option in B<entropy_cl.conf>.  Since B<hwmultd>
drops privileges on startup, it must be configured to run with
sufficient privileges to execute B<ioctl>(..., RNDADDENTROPY, ...).
Usually means root privileges --- see the B<User> option
in B<MAIN CONFIGURATION FILE OPTIONS> below.

=item B<example_hw.so>

This is an example server plugin which simply multicasts
the message set by the B<Message> option in B<example_hw.conf>.

=item B<example_cl.so>

xxx

=item B<null_hw.so>

This is the "do nothing" hardware plugin.  It simulates
a device which always successfully (re)opens and closes,
and returns a null string when read.

=item B<null_cl.so>

This is the "do nothing" client plugin.  It accepts any
input read from the multicast and returns a null string
as its result.  It always success (re)opens and closes.

=item B<script_hw.so>

xxx

=item B<script_cl.so>

xxx

=item B<temp_hw.so>

xxx

=item B<time_hw.so>

xxx

=back

=item F</etc/hwmultd/scripts/>

The directory where scripts used by the I<script_hw.so> and
I<script_cl.so> plugins are stored.

=back

=head2 MAIN CONFIGURATION FILE OPTIONS


The following is a list of options recognized by the main configuration
file, B</etc/hwmultd/hwmultd.conf>.

=over

=item B<Debug>

Default 2

=item B<MulticastIP>

Default 239.252.67.151

=item B<Port>

Default 8000

=item B<Server>

0 = client mode, 1 = server mode, 2 = both Defaults to 0

=item B<User>

Default hwmultd

=item B<Timing>

Default 1

=item B<SourceIP>

Default 0.0.0.0

=item B<Interface>

No default.  It defers to SourceIP if not set.

=item B<HWPlugin>

Default null, the do nothing hardware plugin.

=item B<CLPlugin>

Default null, the do nothing client plugin.

=back

=head1 BUGS

Please report bugs at <http://opensource.dyc.edu/bugzilla3>

=head1 AUTHOR

Anthony G. Basile <basile at opensource dot dyc dot edu>
